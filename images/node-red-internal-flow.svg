<svg width="900" height="360" viewBox="0 0 900 360" xmlns="http://www.w3.org/2000/svg">
  <style>
    .box { fill:#fdfdfd; stroke:#333; stroke-width:1.4; rx:10; ry:10; }
    .title { font-family: system-ui, sans-serif; font-size:18px; font-weight:600; fill:#222; }
    .label { font-family: system-ui, sans-serif; font-size:13px; fill:#222; }
    .small { font-family: system-ui, sans-serif; font-size:11px; fill:#555; }
    .arrow { stroke:#333; stroke-width:1.5; marker-end:url(#arrowhead); fill:none; }
  </style>

  <defs>
    <marker id="arrowhead" markerWidth="9" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 9 3, 0 6" fill="#333"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="28" text-anchor="middle" class="title">Node-RED Internal Flow</text>

  <!-- Input nodes -->
  <rect x="60" y="70" width="150" height="60" class="box"/>
  <text x="135" y="98" text-anchor="middle" class="label">HTTP In</text>
  <text x="135" y="114" text-anchor="middle" class="small">R700 Webhook</text>

  <rect x="60" y="160" width="150" height="60" class="box"/>
  <text x="135" y="188" text-anchor="middle" class="label">MQTT In</text>
  <text x="135" y="204" text-anchor="middle" class="small">R700 MQTT events</text>

  <!-- Merge -->
  <rect x="260" y="115" width="160" height="60" class="box"/>
  <text x="340" y="143" text-anchor="middle" class="label">Parse JSON</text>
  <text x="340" y="159" text-anchor="middle" class="small">msg.payload = body</text>

  <!-- Filter -->
  <rect x="460" y="115" width="180" height="60" class="box"/>
  <text x="550" y="143" text-anchor="middle" class="label">Filter tagInventory</text>
  <text x="550" y="159" text-anchor="middle" class="small">ignore non-tag events</text>

  <!-- Transform -->
  <rect x="680" y="115" width="180" height="60" class="box"/>
  <text x="770" y="135" text-anchor="middle" class="label">Function: build payload</text>
  <text x="770" y="153" text-anchor="middle" class="small">{attributes,time_ms,camera_id}</text>

  <!-- HTTP request -->
  <rect x="680" y="215" width="180" height="60" class="box"/>
  <text x="770" y="243" text-anchor="middle" class="label">HTTP Request</text>
  <text x="770" y="259" text-anchor="middle" class="small">POST â†’ 3rd Party API</text>

  <!-- Logging -->
  <rect x="460" y="215" width="180" height="60" class="box"/>
  <text x="550" y="243" text-anchor="middle" class="label">Log & Metrics</text>
  <text x="550" y="259" text-anchor="middle" class="small">Debug / file / APM</text>

  <!-- Error / retry -->
  <rect x="260" y="215" width="160" height="60" class="box"/>
  <text x="340" y="237" text-anchor="middle" class="label">Catch error</text>
  <text x="340" y="253" text-anchor="middle" class="small">HTTP 4xx/5xx, timeouts</text>

  <rect x="260" y="295" width="160" height="50" class="box"/>
  <text x="340" y="323" text-anchor="middle" class="label">Retry (exp. backoff)</text>

  <!-- HTTP response -->
  <rect x="60" y="250" width="150" height="60" class="box"/>
  <text x="135" y="278" text-anchor="middle" class="label">HTTP Response</text>
  <text x="135" y="294" text-anchor="middle" class="small">200 OK to R700</text>

  <!-- Arrows -->
  <line x1="210" y1="100" x2="260" y2="130" class="arrow"/>
  <line x1="210" y1="190" x2="260" y2="160" class="arrow"/>

  <line x1="420" y1="145" x2="460" y2="145" class="arrow"/>
  <line x1="640" y1="145" x2="680" y2="145" class="arrow"/>

  <line x1="770" y1="175" x2="770" y2="215" class="arrow"/>
  <line x1="640" y1="245" x2="680" y2="245" class="arrow"/>

  <line x1="460" y1="245" x2="420" y2="245" class="arrow"/>
  <line x1="340" y1="175" x2="340" y2="215" class="arrow"/>
  <line x1="340" y1="275" x2="340" y2="295" class="arrow"/>
  <line x1="420" y1="320" x2="770" y2="245" class="arrow"/>

  <line x1="210" y1="280" x2="260" y2="245" class="arrow"/>
</svg>
